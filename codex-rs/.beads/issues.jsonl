{"id":"codex-rs-zk7","title":"Gemini Provider Logic Alignment","description":"Epic to align codex-rs Gemini provider logic with gemini-cli best practices for stability and token efficiency. This involves implementing strict history curation, robust active loop detection, and proper tool cancellation feedback.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-20T12:22:23.70575291+01:00","updated_at":"2025-12-20T12:22:23.70575291+01:00"}
{"id":"codex-rs-zk7.1","title":"Implement Strict History Curation for Gemini","description":"What: Implement a strict history curation pass in core/src/gemini_messages.rs before sending requests to Gemini.\n\nHow: Iterate through message history to merge consecutive turns of the same role and enforce strict User-Model-User alternation. Drop orphaned tool calls or responses if they violate alternation.\n\nWhy: Gemini is extremely strict about history structure. Currently, codex-rs can produce invalid sequences (like text + tool response creating two user turns), leading to fatal 400 errors.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T12:22:30.901597316+01:00","updated_at":"2025-12-20T12:22:37.850954549+01:00","dependencies":[{"issue_id":"codex-rs-zk7.1","depends_on_id":"codex-rs-zk7","type":"parent-child","created_at":"2025-12-20T12:22:30.902037405+01:00","created_by":"daemon"}]}
{"id":"codex-rs-zk7.2","title":"Robust Active Loop Identification for Signatures","description":"What: Improve the logic for identifying the active loop start index in apply_synthetic_thought_signatures.\n\nHow: Instead of looking for the last user message with non-empty text, find the last user message that is NOT a tool response (i.e., does not contain function response parts).\n\nWhy: The current heuristic fails if a user message contains images or other non-text data, potentially leaving the model turn unsigned and causing API rejection.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T12:22:30.911713522+01:00","updated_at":"2025-12-20T12:22:37.857859707+01:00","dependencies":[{"issue_id":"codex-rs-zk7.2","depends_on_id":"codex-rs-zk7","type":"parent-child","created_at":"2025-12-20T12:22:30.911993006+01:00","created_by":"daemon"}]}
{"id":"codex-rs-zk7.3","title":"Implement Explicit Tool Cancellation Feedback","description":"What: Refine explicit tool cancellation feedback and prevent model apology loops.\n\nHow: \n1. Acknowledge existing cancellation feedback in core/src/tools/parallel.rs (injects 'aborted by user').\n2. Verify if non-parallel tool paths correctly inject cancellation messages.\n3. Ensure that when a tool is cancelled, the agent loop short-circuits so the model does NOT immediately generate a response (avoiding apology loops). \n4. Optionally align the 'aborted by user' string with gemini-cli's 'canceled by the user'.\n\nWhy: While a basic mechanism exists, we need to ensure it applies globally and doesn't waste tokens on apology turns after a user explicitly interrupts.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T12:22:30.920506774+01:00","updated_at":"2025-12-20T12:25:46.332442322+01:00","dependencies":[{"issue_id":"codex-rs-zk7.3","depends_on_id":"codex-rs-zk7","type":"parent-child","created_at":"2025-12-20T12:22:30.920766229+01:00","created_by":"daemon"}]}
{"id":"codex-rs-zk7.4","title":"Strip Thought Signatures from Historical Turns","description":"What: Omit the thought_signature property from historical function calls in GeminiContent.\n\nHow: Modify build_gemini_messages to only populate thought_signature for the active turn (most recent exchange).\n\nWhy: Signatures are one-time validation tokens with no semantic value in history. Stripping them saves context window tokens (~5-10 per tool call) and reduces noise.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T12:22:30.929168234+01:00","updated_at":"2025-12-20T12:22:37.870845581+01:00","dependencies":[{"issue_id":"codex-rs-zk7.4","depends_on_id":"codex-rs-zk7","type":"parent-child","created_at":"2025-12-20T12:22:30.929426707+01:00","created_by":"daemon"}]}
