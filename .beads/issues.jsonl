{"id":"codex-4hm","title":"/review fails for non-OpenAI providers due to hardcoded review_model default","description":"When using non-OpenAI providers like antigravity, /review fails with 404 because review_model defaults to gpt-5.1-codex-max which does not exist on those providers. The review uses the same provider but different model, causing the failure.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-07T16:32:02.531502279+01:00","updated_at":"2025-12-07T16:35:16.58935878+01:00","closed_at":"2025-12-07T16:35:16.58935878+01:00"}
{"id":"codex-56f","title":"Scope Gemini OAuth to providers requiring Code Assist","description":"resolve_gemini_credential always prefers stored Gemini OAuth tokens when gemini_account_count\u003e0, forcing all Gemini providers to use Code Assist endpoint and ignoring configured API keys. Public generative-language providers break after codex login --gemini. Adjust credential selection to only use OAuth for providers that explicitly require Code Assist and keep API-key providers on their configured bearer.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-06T13:19:48.565853205+01:00","updated_at":"2025-12-06T13:27:55.960118498+01:00","closed_at":"2025-12-06T13:27:55.960118498+01:00"}
{"id":"codex-5qi","title":"Antigravity provider should not require project id","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-07T11:30:15.058435632+01:00","updated_at":"2025-12-07T11:41:06.66799857+01:00","closed_at":"2025-12-07T11:41:06.66799857+01:00"}
{"id":"codex-64j","title":"Shared MCP connection manager and lazy MCP initialization","description":"Refactor MCP so connections are shared, lazily initialized per server, and no longer block session or subagent startup. Sessions and tools should treat MCP as an optional, per-server resource with explicit readiness, and the TUI should surface server status without delaying conversation flow.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-11T00:41:05.704146041+01:00","updated_at":"2025-12-11T01:08:13.833574857+01:00","closed_at":"2025-12-11T01:08:13.833574857+01:00"}
{"id":"codex-64j.1","title":"Harden and document MCP behavior (errors, timeouts, tests)","description":"Add tests and docs for the new MCP lifecycle: per-server lazy init, shared connections, and explicit readiness. Cover success, timeout, and failure paths, including what the model sees when a server is still starting or permanently failed. Update docs/config.md (MCP section) to describe the new behavior and any user-facing status messages.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T00:41:16.198131799+01:00","updated_at":"2025-12-11T01:08:10.029185972+01:00","closed_at":"2025-12-11T01:08:10.029185972+01:00","dependencies":[{"issue_id":"codex-64j.1","depends_on_id":"codex-64j","type":"parent-child","created_at":"2025-12-11T00:41:16.198413878+01:00","created_by":"daemon"}]}
{"id":"codex-64j.2","title":"Optimize subagent behavior with shared MCP clients","description":"Change subagent sessions to reuse the shared McpConnectionManager instead of reinitializing MCP per subagent. Ensure subagents pay zero MCP startup cost unless they actually invoke MCP tools, and verify that authorization/env isolation is handled via per-request metadata rather than redundant connections.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T00:41:16.21135687+01:00","updated_at":"2025-12-11T01:08:05.48787264+01:00","closed_at":"2025-12-11T01:08:05.48787264+01:00","dependencies":[{"issue_id":"codex-64j.2","depends_on_id":"codex-64j","type":"parent-child","created_at":"2025-12-11T00:41:16.211663315+01:00","created_by":"daemon"}]}
{"id":"codex-64j.3","title":"Add explicit MCP readiness and status to tool calls and TUI","description":"Plumb MCP server status into events so that the TUI can show per-server startup state (starting/ready/failed) without blocking the session. Update MCP tool handlers to surface clean, typed errors on not-ready/failed servers, and adjust the TUI to render these as actionable messages rather than generic tool failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T00:41:16.225203698+01:00","updated_at":"2025-12-11T01:08:00.743117603+01:00","closed_at":"2025-12-11T01:08:00.743117603+01:00","dependencies":[{"issue_id":"codex-64j.3","depends_on_id":"codex-64j","type":"parent-child","created_at":"2025-12-11T00:41:16.225523038+01:00","created_by":"daemon"}]}
{"id":"codex-64j.4","title":"Make MCP initialization lazy and per-server","description":"Remove the global upfront initialize() call from Session::new. Instead, have the MCP tool handler (and any direct users) call ensure_started(server) and wait_ready(server, timeout) before a tool call. Only initialize servers that are actually requested in a session, and ensure error paths are well-defined when a server is disabled or fails to connect.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T00:41:16.239103688+01:00","updated_at":"2025-12-11T01:07:56.428050943+01:00","closed_at":"2025-12-11T01:07:56.428050943+01:00","dependencies":[{"issue_id":"codex-64j.4","depends_on_id":"codex-64j","type":"parent-child","created_at":"2025-12-11T00:41:16.239380357+01:00","created_by":"daemon"}]}
{"id":"codex-64j.5","title":"Refactor McpConnectionManager into a shared, process-wide manager","description":"Move MCP connection management out of individual sessions into a shared McpConnectionManager that lives for the process (or workspace). Expose APIs to get or start a client per server (by name), track per-server status (NotConfigured/Pending/Connecting/Ready/Failed), and ensure configuration (McpServerConfig, OAuth store mode) is passed in cleanly without coupling to Session internals.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T00:41:16.251475348+01:00","updated_at":"2025-12-11T00:57:16.308717259+01:00","closed_at":"2025-12-11T00:57:16.308717259+01:00","dependencies":[{"issue_id":"codex-64j.5","depends_on_id":"codex-64j","type":"parent-child","created_at":"2025-12-11T00:41:16.251993197+01:00","created_by":"daemon"}]}
{"id":"codex-6kk","title":"Provider-agnostic quota support for /status (Antigravity + ChatGPT)","description":"Unify how Codex fetches and displays model usage quotas across providers, starting with ChatGPT and Antigravity. Introduce a provider-agnostic quota abstraction in core, implement an Antigravity quota client that mirrors AntigravityQuota’s GetUserStatus behavior, and wire everything into the TUI’s /status command so it always reflects the current provider’s limits and credits.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-11T00:59:44.83405989+01:00","updated_at":"2025-12-11T00:59:44.83405989+01:00"}
{"id":"codex-6kk.1","title":"Add tests and docs for provider quota integration","description":"Add integration and snapshot tests that cover /status for both ChatGPT and Antigravity providers, including cases with missing quotas, stale data, and low-credit warnings. Ensure the TUI status card snapshots remain stable and readable. Update the docs (e.g., docs/config.md and any /status-related docs) to explain how Codex derives usage/limit information per provider, what users should expect for ChatGPT vs Antigravity, and how to troubleshoot when quota data is unavailable (e.g., Antigravity language server not running).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T00:59:54.344454208+01:00","updated_at":"2025-12-11T00:59:54.344454208+01:00","dependencies":[{"issue_id":"codex-6kk.1","depends_on_id":"codex-6kk","type":"parent-child","created_at":"2025-12-11T00:59:54.344812683+01:00","created_by":"daemon"}]}
{"id":"codex-6kk.2","title":"Wire provider quotas into TUI /status for ChatGPT and Antigravity","description":"Update the TUI layer so /status always uses provider-specific quotas when available. Replace the current ChatGPT-only fetch_rate_limits() logic with a call into the new provider-agnostic quota API, and add an Antigravity branch that invokes AntigravityQuotaClient behind the same abstraction. Ensure quota fetching happens in the background (via AppEvent::RateLimitSnapshotFetched) and that /status renders correctly whether quotas are fresh, missing, or stale. Verify the status card remains provider-neutral and does not hard-code ChatGPT-specific language.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T00:59:54.35852021+01:00","updated_at":"2025-12-11T00:59:54.35852021+01:00","dependencies":[{"issue_id":"codex-6kk.2","depends_on_id":"codex-6kk","type":"parent-child","created_at":"2025-12-11T00:59:54.358836664+01:00","created_by":"daemon"}]}
{"id":"codex-6kk.3","title":"Design provider-agnostic quota API in core","description":"Introduce a small, provider-neutral quota abstraction in codex-core (e.g., a ProviderQuotaClient trait) that can return a standard RateLimitSnapshot for the current provider. Define how this trait discovers the right implementation based on AuthMode / model_provider_id, how it should behave when quotas are unavailable (None), and how it should avoid blocking the main turn loop (async-only, with clear timeout behavior). Document the API so other providers (Anthropic, Gemini, etc.) can plug in later without touching the TUI.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T00:59:54.37383815+01:00","updated_at":"2025-12-11T00:59:54.37383815+01:00","dependencies":[{"issue_id":"codex-6kk.3","depends_on_id":"codex-6kk","type":"parent-child","created_at":"2025-12-11T00:59:54.374196324+01:00","created_by":"daemon"}]}
{"id":"codex-6kk.4","title":"Implement Antigravity quota client using GetUserStatus","description":"Add an AntigravityQuotaClient in codex-core that mirrors the AntigravityQuota VS Code extension: detect the local Antigravity language_server process, discover its listening port and CSRF token, and call the /exa.language_server_pb.LanguageServerService/GetUserStatus endpoint over HTTPS. Parse the server_user_status_response into a structured Rust type, then map it into Codex’s RateLimitSnapshot + CreditsSnapshot, including monthly prompt credits, available credits, and a reasonable used_percent and reset time. Ensure the client is robust to the language server not running, connection errors, and malformed responses, returning None instead of panicking.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T00:59:54.389404355+01:00","updated_at":"2025-12-11T00:59:54.389404355+01:00","dependencies":[{"issue_id":"codex-6kk.4","depends_on_id":"codex-6kk","type":"parent-child","created_at":"2025-12-11T00:59:54.389727001+01:00","created_by":"daemon"}]}
{"id":"codex-6kk.5","title":"Extend RateLimitSnapshot mapping for Antigravity-specific fields","description":"Define a precise mapping from Antigravity’s GetUserStatus response into Codex’s RateLimitSnapshot and CreditsSnapshot models. Decide how to represent prompt credits (monthly vs available) and per-model quotas in the existing primary/secondary windows and credits fields without breaking ChatGPT behavior. Implement this mapping in core, add unit tests that feed in realistic AntigravityQuota-like payloads, and confirm the /status card shows intuitive percentages, reset times, and credit balances for Antigravity users.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T00:59:54.405867483+01:00","updated_at":"2025-12-11T00:59:54.405867483+01:00","dependencies":[{"issue_id":"codex-6kk.5","depends_on_id":"codex-6kk","type":"parent-child","created_at":"2025-12-11T00:59:54.406326319+01:00","created_by":"daemon"}]}
{"id":"codex-7kf","title":"Migrate Custom Features (Providers, Subagents, UI)","description":"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-05T13:57:24.388988989+01:00","updated_at":"2025-12-05T16:02:22.845701629+01:00","closed_at":"2025-12-05T16:02:22.845701629+01:00"}
{"id":"codex-7kf.1","title":"Migrate Multi-provider Support (Gemini, Anthropic)","description":"Port core backend support for Gemini and Anthropic from the old fork to codex-rs/core.\n\nSTEPS:\n1. Copy source files from old fork (core/src/):\n   - gemini.rs\n   - gemini_messages.rs\n   - anthropic_messages.rs\n2. Copy resource files:\n   - core/gemini-3-prompt.md\n3. Integrate into codex-rs/core:\n   - Update lib.rs to expose modules\n   - Update model_family.rs to include Gemini/Anthropic variants\n   - Update model_provider_info logic if necessary","notes":"Gemini + Anthropic scaffolds ported; proceeding to subagents","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-05T13:57:30.334759125+01:00","updated_at":"2025-12-05T15:33:33.919881922+01:00","closed_at":"2025-12-05T15:33:33.919885529+01:00","dependencies":[{"issue_id":"codex-7kf.1","depends_on_id":"codex-7kf","type":"parent-child","created_at":"2025-12-05T13:57:30.335098263+01:00","created_by":"daemon"}]}
{"id":"codex-7kf.1.1","title":"Port Gemini Support","description":"Port all Gemini-related code and assets.\n\nFILES TO COPY:\n- /core/src/gemini.rs\n- /core/src/gemini_messages.rs\n- /core/gemini-3-prompt.md\n\nINTEGRATION:\n- Add modules to core/src/lib.rs\n- Register Gemini as a provider in core/src/model_family.rs","notes":"Gemini provider files ported, compiling in codex-core","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T13:58:34.905643645+01:00","updated_at":"2025-12-05T15:24:55.559395065+01:00","closed_at":"2025-12-05T15:24:55.559399624+01:00","dependencies":[{"issue_id":"codex-7kf.1.1","depends_on_id":"codex-7kf.1","type":"parent-child","created_at":"2025-12-05T13:58:34.905983584+01:00","created_by":"daemon"}]}
{"id":"codex-7kf.1.2","title":"Port Anthropic Support","description":"Port Anthropic-related code.\n\nFILES TO COPY:\n- /core/src/anthropic_messages.rs\n\nINTEGRATION:\n- Add modules to core/src/lib.rs\n- Register Anthropic as a provider in core/src/model_family.rs (if distinct from OpenAI/Gemini path)","notes":"Anthropic messages/provider ported and compiling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T13:58:43.383129271+01:00","updated_at":"2025-12-05T15:31:40.109495912+01:00","closed_at":"2025-12-05T15:31:40.109498948+01:00","dependencies":[{"issue_id":"codex-7kf.1.2","depends_on_id":"codex-7kf.1","type":"parent-child","created_at":"2025-12-05T13:58:43.383462036+01:00","created_by":"daemon"}]}
{"id":"codex-7kf.2","title":"Migrate Subagents Architecture","description":"Port the subagent orchestration logic to enable task delegation.\n\nSTEPS:\n1. Copy core/src/subagents.rs to codex-rs/core/src/\n2. Copy core/src/tools/handlers/task.rs to codex-rs/core/src/tools/handlers/\n3. Register the 'task' tool in the core tool registry\n4. Ensure the task handler hooks correctly into the event loop in codex-rs/app-server or core","notes":"Subagent scaffolding and task tool stubbed; responds unsupported pending full wiring","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-05T13:57:34.951409492+01:00","updated_at":"2025-12-05T15:43:43.070080627+01:00","closed_at":"2025-12-05T15:43:43.070085035+01:00","dependencies":[{"issue_id":"codex-7kf.2","depends_on_id":"codex-7kf","type":"parent-child","created_at":"2025-12-05T13:57:34.951692232+01:00","created_by":"daemon"}]}
{"id":"codex-7kf.3","title":"Update TUI for New Providers and Subagents","description":"Adapt the TUI to render non-OpenAI models and subagent activities.\n\nSTEPS:\n1. Port TUI view modes:\n   - Copy/Adapt tui/src/tui/inline.rs\n   - Copy/Adapt tui/src/tui/standard.rs\n2. Update rendering logic:\n   - Check tui/src/chatwidget.rs for provider-specific rendering adjustments\n   - Ensure subagent tool calls are displayed correctly","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-05T13:57:39.162584085+01:00","updated_at":"2025-12-05T16:02:19.277920853+01:00","closed_at":"2025-12-05T16:02:19.277920853+01:00","dependencies":[{"issue_id":"codex-7kf.3","depends_on_id":"codex-7kf","type":"parent-child","created_at":"2025-12-05T13:57:39.162905789+01:00","created_by":"daemon"}]}
{"id":"codex-83k","title":"Show model_provider and model in footer","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:13:54.687590171+01:00","updated_at":"2025-12-07T16:17:24.942337442+01:00","closed_at":"2025-12-07T16:17:24.942337442+01:00"}
{"id":"codex-8k0","title":"Drop legacy execpolicy + local providers","description":"Goal: reduce fork complexity and future upstream merge friction by removing two unused stacks.\n\nScope:\n1) Remove execpolicy-legacy:\n- Delete the codex-execpolicy-legacy crate and remove execpolicy-legacy from the workspace.\n- Remove any remaining references in docs, tests, and Cargo manifests/lockfile.\n\n2) Remove local providers:\n- Delete codex-lmstudio and codex-ollama crates and remove them from the workspace.\n- Remove OSS-provider plumbing tied to these crates (oss_provider config option, LMSTUDIO/OLLAMA provider IDs/ports/constants, ensure_oss_ready helpers).\n- Remove CLI/TUI flags and help text for choosing local providers.\n- Update docs and tests/snapshots that mention local providers.\n\nDone when:\n- Workspace builds and tests pass without these crates.\n- No code/docs mention execpolicy-legacy, lmstudio, ollama, or oss_provider.\n- CLI/TUI help output no longer offers local providers.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-12T00:46:52.037997823+01:00","updated_at":"2025-12-12T01:08:24.078052292+01:00","closed_at":"2025-12-12T01:08:24.078052292+01:00"}
{"id":"codex-8k0.1","title":"Clean CLI/TUI + docs/tests","description":"Follow-up cleanup after dropping local providers:\n- Remove local-provider CLI/TUI flags and any related help text.\n- Update docs and example config to remove oss_provider and local provider mention.\n- Update or delete tests/snapshots referencing lmstudio or ollama.\n- Run targeted tests for affected crates.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T00:47:23.724088879+01:00","updated_at":"2025-12-12T01:08:19.386507206+01:00","closed_at":"2025-12-12T01:08:19.386507206+01:00","dependencies":[{"issue_id":"codex-8k0.1","depends_on_id":"codex-8k0","type":"parent-child","created_at":"2025-12-12T00:47:23.724700548+01:00","created_by":"daemon"}]}
{"id":"codex-8k0.2","title":"Remove lmstudio/ollama crates","description":"Delete local provider crates:\n- Remove lmstudio and ollama from codex-rs/Cargo.toml workspace members and workspace dependencies.\n- Delete codex-rs/lmstudio and codex-rs/ollama crate directories.\n- Remove their usage from codex-common OSS helper, codex-core model provider registry, and config parsing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T00:47:23.749404256+01:00","updated_at":"2025-12-12T01:08:09.414548804+01:00","closed_at":"2025-12-12T01:08:09.414548804+01:00","dependencies":[{"issue_id":"codex-8k0.2","depends_on_id":"codex-8k0","type":"parent-child","created_at":"2025-12-12T00:47:23.74966263+01:00","created_by":"daemon"}]}
{"id":"codex-8k0.3","title":"Remove execpolicy-legacy crate","description":"Delete codex-execpolicy-legacy:\n- Remove execpolicy-legacy from codex-rs/Cargo.toml workspace members and workspace dependencies.\n- Delete codex-rs/execpolicy-legacy crate directory.\n- Remove references to the legacy matcher/binary from execpolicy README and any docs/tests.\n- Regenerate Cargo.lock and ensure no dependency edges remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T00:47:23.760783007+01:00","updated_at":"2025-12-12T01:08:13.729300306+01:00","closed_at":"2025-12-12T01:08:13.729300306+01:00","dependencies":[{"issue_id":"codex-8k0.3","depends_on_id":"codex-8k0","type":"parent-child","created_at":"2025-12-12T00:47:23.761067881+01:00","created_by":"daemon"}]}
{"id":"codex-bl3","title":"Gemini Low effort thinking_budget (512) is below Anthropic minimum (1024)","description":"When using Claude through Antigravity with Low reasoning effort (e.g., /review), the thinking_budget is set to 512 but Anthropic requires minimum 1024. This causes 400 errors.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-07T16:41:57.845756316+01:00","updated_at":"2025-12-07T16:47:59.841970442+01:00","closed_at":"2025-12-07T16:47:59.841970442+01:00"}
{"id":"codex-cs1","title":"Fix Gemini login prefers newest credential","description":"Gemini login currently keeps using the first stored credential; new logins append to auth.json but core picks index 0 so refreshed tokens are ignored unless users edit auth.json. Update persistence to promote most recent Gemini tokens to the front so runtime uses latest login.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-06T12:59:39.702700307+01:00","updated_at":"2025-12-06T13:04:15.269773177+01:00","closed_at":"2025-12-06T13:04:15.269773177+01:00"}
{"id":"codex-d55","title":"Restrict subagent access to other subagents","description":"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-10T11:46:51.10983909+01:00","updated_at":"2025-12-10T12:28:12.239896299+01:00","closed_at":"2025-12-10T12:28:12.239896299+01:00"}
{"id":"codex-d55.1","title":"Update Subagent Configuration Schema","description":"Modify `SubagentMetadata` in `codex-rs/core/src/subagents.rs` to include an optional list of allowed subagent slugs (e.g., `allowed_subagents: Vec\u003cString\u003e`). This will allow subagents to declare which other subagents they need access to in their frontmatter.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:46:59.596535735+01:00","updated_at":"2025-12-10T12:10:37.503321809+01:00","closed_at":"2025-12-10T12:10:37.503321809+01:00","dependencies":[{"issue_id":"codex-d55.1","depends_on_id":"codex-d55","type":"parent-child","created_at":"2025-12-10T11:46:59.596858281+01:00","created_by":"daemon"}]}
{"id":"codex-d55.2","title":"Pass Subagent Context to ToolsConfig","description":"Update `SessionConfiguration` and `ToolsConfig` to carry the list of allowed subagents. In `codex-rs/core/src/tools/handlers/task.rs`, extract the `allowed_subagents` from metadata when spawning a subagent and pass it to the new session configuration. Root sessions should have full access (None), while subagents should default to no access (Some(vec![])) unless specified.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:47:06.411262442+01:00","updated_at":"2025-12-10T12:20:43.504662463+01:00","closed_at":"2025-12-10T12:20:43.504662463+01:00","dependencies":[{"issue_id":"codex-d55.2","depends_on_id":"codex-d55","type":"parent-child","created_at":"2025-12-10T11:47:06.411575129+01:00","created_by":"daemon"}]}
{"id":"codex-d55.3","title":"Conditionally Inject and Filter Task Tool","description":"Modify `build_specs` in `codex-rs/core/src/tools/spec.rs` to check `ToolsConfig.allowed_subagents`. If `None`, inject the task tool with full access. If `Some(list)`, only inject the task tool if the list is not empty, and filter the available agents in the tool description to match the allowed list. If the list is empty, do not inject the task tool.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:47:19.761597046+01:00","updated_at":"2025-12-10T12:23:18.651057619+01:00","closed_at":"2025-12-10T12:23:18.651057619+01:00","dependencies":[{"issue_id":"codex-d55.3","depends_on_id":"codex-d55","type":"parent-child","created_at":"2025-12-10T11:47:19.761959358+01:00","created_by":"daemon"}]}
{"id":"codex-d8a","title":"Gemini tokens ignored when API key present","description":"load_auth early returns CodexAuth::from_api_key_with_client when auth.json includes an API key, discarding gemini_accounts snapshot. Runtime then sees zero Gemini accounts and keeps using API key. Need to preserve auth snapshot so Gemini tokens remain accessible even when API key exists.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-06T13:09:00.722385922+01:00","updated_at":"2025-12-06T13:49:19.30910605+01:00","closed_at":"2025-12-06T13:49:19.30910605+01:00"}
{"id":"codex-i1t","title":"Implement Antigravity Provider Support","description":"","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-06T12:34:26.379799781+01:00","updated_at":"2025-12-06T22:44:23.612368907+01:00"}
{"id":"codex-i1t.1","title":"Define Antigravity Protocol and Types","description":"Extend core types to recognize Antigravity as a distinct authentication mode and wire protocol.\n\n**Actions:**\n1.  **codex-rs/app-server-protocol/src/protocol/common.rs**:\n    *   Update `enum AuthMode` to include `Antigravity`.\n    *   This distinguishes the login/auth flow from standard Gemini.\n\n2.  **codex-rs/core/src/model_provider_info.rs**:\n    *   Update `enum WireApi` to include `Antigravity`.\n    *   Update `enum ProviderKind` to include `Antigravity` (optional, but recommended for consistency).\n\n**Why:**\nThis is the foundational type work needed before we can write the implementation logic.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T12:34:31.707276308+01:00","updated_at":"2025-12-06T22:46:13.199124796+01:00","closed_at":"2025-12-06T22:46:13.199124796+01:00","dependencies":[{"issue_id":"codex-i1t.1","depends_on_id":"codex-i1t","type":"parent-child","created_at":"2025-12-06T12:34:31.707575027+01:00","created_by":"daemon"}]}
{"id":"codex-i1t.2","title":"Add Antigravity Configuration and Constants","description":"Create the configuration module containing hardcoded credentials and endpoints.\n\n**Actions:**\n1.  **Create file**: `codex-rs/core/src/antigravity.rs`\n2.  **Add Constants** (Mirroring the Python reference implementation):\n    *   `ANTIGRAVITY_CLIENT_ID`: \"1071006060591-tmhssin2h21lcre235vtolojh4g403ep.apps.googleusercontent.com\"\n    *   `ANTIGRAVITY_CLIENT_SECRET`: \"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\"\n    *   `ANTIGRAVITY_AUTH_URL`, `ANTIGRAVITY_TOKEN_URL` (Standard Google OAuth endpoints).\n    *   `ANTIGRAVITY_ENDPOINT`: \"https://daily-cloudcode-pa.sandbox.googleapis.com\" (Note: Use the Sandbox URL as primary).\n    *   `ANTIGRAVITY_SCOPES`: Must include:\n        *   `https://www.googleapis.com/auth/cloud-platform`\n        *   `https://www.googleapis.com/auth/userinfo.email`\n        *   `https://www.googleapis.com/auth/cclog` (Critical)\n        *   `https://www.googleapis.com/auth/experimentsandconfigs` (Critical)\n\n**Why:**\nThese specific credentials and scopes are required to masquerade as the Antigravity client.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T12:34:38.497295683+01:00","updated_at":"2025-12-06T22:47:24.157608954+01:00","closed_at":"2025-12-06T22:47:24.157608954+01:00","dependencies":[{"issue_id":"codex-i1t.2","depends_on_id":"codex-i1t","type":"parent-child","created_at":"2025-12-06T12:34:38.4976193+01:00","created_by":"daemon"}]}
{"id":"codex-i1t.3","title":"Implement Antigravity Authentication Flow","description":"Implement the OAuth flow using the Antigravity credentials.\n\n**Actions:**\n1.  **codex-rs/core/src/auth.rs**:\n    *   Update `CodexAuth` to handle `AuthMode::Antigravity`.\n    *   In `refresh_token()` logic:\n        *   Check if `mode == AuthMode::Antigravity`.\n        *   If so, use `antigravity::ANTIGRAVITY_CLIENT_ID/SECRET` instead of the Gemini ones.\n    *   In `login()` (if applicable) or manual token setup paths, ensure the correct scopes are requested.\n2.  **codex-rs/core/src/token_data.rs**:\n    *   Reuse `GeminiTokenData` struct for storage, as the fields (access_token, refresh_token, project_id) are identical.\n\n**Why:**\nWe need to authenticate *as* Antigravity to be allowed to call the internal endpoints.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T12:34:44.751257296+01:00","updated_at":"2025-12-06T23:27:23.359225469+01:00","closed_at":"2025-12-06T23:27:23.359225469+01:00","dependencies":[{"issue_id":"codex-i1t.3","depends_on_id":"codex-i1t","type":"parent-child","created_at":"2025-12-06T12:34:44.751596443+01:00","created_by":"daemon"}]}
{"id":"codex-i1t.4","title":"Refactor Gemini Messages for Reusability","description":"Extract payload construction logic to allow wrapping.\n\n**Actions:**\n1.  **codex-rs/core/src/gemini_messages.rs**:\n    *   Locate the `stream_gemini_messages` function.\n    *   Extract the logic that builds the `GeminiRequest` struct (converting `Prompt`, `tools`, etc.) into a new public function:\n        ```rust\n        pub fn build_gemini_payload(prompt: \u0026Prompt, config: \u0026Config, ...) -\u003e Result\u003cGeminiRequest\u003e\n        ```\n    *   Make `GeminiRequest` and its inner types (`GeminiContent`, `GeminiTool`, etc.) public (or public to crate) so they can be used by the Antigravity module.\n\n**Why:**\nAntigravity uses the *exact same* internal payload structure, but wraps it in an outer envelope. We must not duplicate the complex logic of converting Codex prompts/tools into the Gemini format.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T12:34:50.699256599+01:00","updated_at":"2025-12-06T23:27:28.524168016+01:00","closed_at":"2025-12-06T23:27:28.524168016+01:00","dependencies":[{"issue_id":"codex-i1t.4","depends_on_id":"codex-i1t","type":"parent-child","created_at":"2025-12-06T12:34:50.69960826+01:00","created_by":"daemon"}]}
{"id":"codex-i1t.5","title":"Implement Antigravity Message Streaming","description":"Implement the core Antigravity request/response logic.\n\n**Actions:**\n1.  **Create file**: `codex-rs/core/src/antigravity_messages.rs`\n2.  **Request Logic**:\n    *   Call `gemini_messages::build_gemini_payload(...)` to get the inner model request.\n    *   Wrap it in the Antigravity envelope:\n        ```rust\n        #[derive(Serialize)]\n        struct AntigravityRequest {\n            project: String, // from token data\n            userAgent: String, // MUST be \"antigravity\"\n            requestId: String, // \"agent-{uuid}\"\n            model: String,     // e.g. \"gemini-3-pro-preview\"\n            request: GeminiRequest,\n        }\n        ```\n3.  **Streaming Logic**:\n    *   Send POST to `{ANTIGRAVITY_ENDPOINT}/v1internal:streamGenerateContent`.\n    *   Use `eventsource-stream` (or similar) to handle SSE.\n4.  **Response Unwrapping**:\n    *   The stream yields JSON chunks.\n    *   **Crucial Step**: The chunks are Antigravity envelopes. You must extract the inner `response` field.\n        *   Example Chunk: `{\"responseId\": \"...\", \"response\": { \"candidates\": [...] }}`\n        *   Extract the inner object and treat it exactly like a standard Gemini chunk.\n    *   Reuse `gemini_messages::handle_stream_chunk` (or similar logic) if possible, or adapt it to parse the unwrapped chunk.\n\n**Why:**\nThis is the core logic that differentiates Antigravity from standard Gemini. The envelope makes the server treat us as the internal \"CloudCode\" tool.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T12:34:57.840908107+01:00","updated_at":"2025-12-06T23:27:36.456056193+01:00","closed_at":"2025-12-06T23:27:36.456056193+01:00","dependencies":[{"issue_id":"codex-i1t.5","depends_on_id":"codex-i1t","type":"parent-child","created_at":"2025-12-06T12:34:57.841295316+01:00","created_by":"daemon"}]}
{"id":"codex-i1t.6","title":"Wire Antigravity into Client and Config","description":"Integrate the new provider into the main client dispatch.\n\n**Actions:**\n1.  **codex-rs/core/src/client.rs**:\n    *   In `ModelClient::stream()`, add a match arm for `WireApi::Antigravity`.\n    *   Call `antigravity_messages::stream_antigravity_messages(...)`.\n2.  **codex-rs/core/src/model_provider_info.rs**:\n    *   Ensure configuration loading (TOML) supports the new `wire_api = \"antigravity\"` string enum.\n\n**Why:**\nThis makes the new functionality accessible to the end user via their config.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T12:35:02.836823082+01:00","updated_at":"2025-12-06T23:53:10.512430351+01:00","closed_at":"2025-12-06T23:53:10.512430351+01:00","dependencies":[{"issue_id":"codex-i1t.6","depends_on_id":"codex-i1t","type":"parent-child","created_at":"2025-12-06T12:35:02.837109549+01:00","created_by":"daemon"}]}
{"id":"codex-u12","title":"Use model_context_window from config for context percentage calculation","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:13:59.274785935+01:00","updated_at":"2025-12-07T16:18:05.979811379+01:00","closed_at":"2025-12-07T16:18:05.979811379+01:00"}
{"id":"codex-vq1","title":"ChatGPT login overwrites Gemini tokens","description":"persist_tokens_async in login/server.rs builds a fresh AuthDotJson with empty gemini_accounts when saving ChatGPT tokens, wiping existing Gemini credentials. Need to merge with existing auth.json so Gemini accounts survive ChatGPT login.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-06T13:55:23.755383003+01:00","updated_at":"2025-12-06T13:57:34.877510865+01:00","closed_at":"2025-12-06T13:57:34.877510865+01:00"}
